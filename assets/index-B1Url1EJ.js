(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function V(e,i,t,n){const s=n==="medium"||n==="hard"?"square":t,a=[];for(let r=0;r<e;r++){const c=[];for(let u=0;u<i;u++)c.push({r,c:u,isMine:!1,isRevealed:!1,flagState:0,neighborMines:0,distanceHint:0,isActive:$(r,u,e,i,s)});a.push(c)}return a}function $(e,i,t,n,s){if(s==="square")return!0;if(s==="snake"){const a=Math.floor(t/5);return e<a||e<a*2&&i>=n-a*2||e>=a*2&&e<a*3||e>=a*3&&e<a*4&&i<a*2||e>=a*4}if(s==="block"){const a=Math.floor(n/3);return i<a||i>=n-a||e>=Math.floor(t/2)-1&&e<=Math.floor(t/2)+1}return!0}function C(e,i,t){const n=e[i][t];if(!n.isActive||n.isRevealed||n.flagState===1)return 0;n.isRevealed=!0;let s=10;return b(e,i,t,1)===0&&T(e,i,t,1).forEach(c=>{!c.isRevealed&&!c.isFlagged&&(s+=C(e,c.r,c.c))}),s}function G(e){e.isRevealed||(e.flagState=(e.flagState+1)%3)}function O(e,i){let t=0,n=0;return e.flat().forEach(s=>{s.isActive&&(n++,s.isRevealed&&t++)}),t===n-i}function T(e,i,t,n){const s=[],a=e.length,r=e[0].length;for(let c=-n;c<=n;c++)for(let u=-n;u<=n;u++){if(c===0&&u===0)continue;if(Math.max(Math.abs(c),Math.abs(u))===n){const m=i+c,y=t+u;m>=0&&m<a&&y>=0&&y<r&&e[m][y].isActive&&s.push(e[m][y])}}return s}function b(e,i,t,n){return T(e,i,t,n).filter(a=>a.isMine).length}function L(e){const i=e.length,t=e[0].length;for(let n=0;n<i;n++)for(let s=0;s<t;s++){const a=e[n][s];if(!a.isActive||a.isMine)continue;const r=b(e,n,s,1);if(r>0){a.neighborMines=r,a.distanceHint=0;continue}if(b(e,n,s,2)>0){a.neighborMines=0,a.distanceHint=2;continue}if(b(e,n,s,3)>0){a.neighborMines=0,a.distanceHint=3;continue}a.neighborMines=0,a.distanceHint=0}}function P(e,i){const t=e.length,n=e[0].length,s=[],a=[];for(let r=0;r<t;r++)for(let c=0;c<n;c++)e[r][c].isActive&&a.push(e[r][c]);a.sort(()=>Math.random()-.5);for(let r=0;r<Math.min(i,a.length);r++)a[r].isMine=!0,s.push({r:a[r].r,c:a[r].c});return s}function H(e,i){let t=!1;const n=new Set(i.map(s=>`${s.r},${s.c}`));for(let s=0;s<i.length;s++){const a=i[s],r=e[a.r][a.c];if(r.flagState===1)continue;const u=T(e,a.r,a.c,1).filter(m=>!m.isRevealed&&!m.isMine&&!n.has(`${m.r},${m.c}`));u.push(r);const l=u[Math.floor(Math.random()*u.length)];l!==r&&(r.isMine=!1,l.isMine=!0,n.delete(`${a.r},${a.c}`),n.add(`${l.r},${l.c}`),i[s]={r:l.r,c:l.c},t=!0)}return t}const S="miner_ranking";function M(){const e=localStorage.getItem(S);return e?JSON.parse(e):{easy:[],medium:[],hard:[]}}function w(e,i,t){const n=M();n[e]||(n[e]=[]),n[e].push({name:i,score:t,date:new Date().toISOString()}),n[e].sort((s,a)=>a.score-s.score),n[e]=n[e].slice(0,10),localStorage.setItem(S,JSON.stringify(n))}function N(){localStorage.removeItem(S)}function F(){const e=document.createElement("canvas");e.id="bg-canvas";const i=document.getElementById("bg-canvas");i&&i.remove(),document.body.prepend(e);const t=e.getContext("2d");let n,s;const a=[];function r(){n=e.width=window.innerWidth,s=e.height=window.innerHeight}window.addEventListener("resize",r),r();class c{constructor(){this.reset(!0)}reset(m=!1){this.x=Math.random()*n,this.y=m?Math.random()*s:s+50,this.vx=(Math.random()-.5)*.5,this.vy=-(Math.random()*.5+.5),this.size=Math.random()*20+15,this.rotation=Math.random()*360,this.vr=(Math.random()-.5)*2,this.alpha=Math.random()*.3+.1,this.type=Math.random()>.6?"mine":"flag",this.exploding=!1,this.explodeProgress=0}update(){if(this.exploding){this.explodeProgress+=.05,this.size+=1,this.alpha-=.05,this.alpha<=0&&this.reset();return}this.x+=this.vx,this.y+=this.vy,this.rotation+=this.vr,this.type==="mine"&&Math.random()<.002&&(this.exploding=!0),this.y<-50&&this.reset()}draw(){if(t.save(),t.globalAlpha=this.alpha,t.translate(this.x,this.y),t.rotate(this.rotation*Math.PI/180),this.type==="mine")if(this.exploding){t.fillStyle="#ef4444",t.beginPath();for(let m=0;m<8;m++)t.rotate(Math.PI/4),t.lineTo(this.size,0),t.lineTo(this.size/2,this.size/2);t.fill()}else t.fillStyle="#1e293b",t.beginPath(),t.arc(0,0,this.size/2,0,Math.PI*2),t.fill(),t.fillStyle="#334155",t.fillRect(-this.size/4,-this.size/1.6,this.size/2,this.size/4),t.beginPath(),t.strokeStyle="#64748b",t.lineWidth=2,t.moveTo(0,-this.size/1.6),t.quadraticCurveTo(this.size/3,-this.size,this.size/1.5,-this.size/1.2),t.stroke(),t.fillStyle="#ef4444",t.beginPath(),t.arc(this.size/1.5,-this.size/1.2,3,0,Math.PI*2),t.fill();else t.fillStyle="#ef4444",t.beginPath(),t.moveTo(-this.size/3,-this.size/2),t.lineTo(this.size/3,-this.size/4),t.lineTo(-this.size/3,0),t.fill(),t.strokeStyle="#1e293b",t.lineWidth=2,t.beginPath(),t.moveTo(-this.size/3,-this.size/2),t.lineTo(-this.size/3,this.size/2),t.stroke();t.restore()}}for(let l=0;l<30;l++)a.push(new c);function u(){t.clearRect(0,0,n,s),a.forEach(l=>{l.update(),l.draw()}),requestAnimationFrame(u)}u()}function W(e){document.querySelectorAll(".screen").forEach(i=>i.classList.remove("active")),document.getElementById(e).classList.add("active")}function f(e){const i=document.getElementById("message-area");i.textContent=e}function R(e){document.getElementById("timer").textContent=e}function D(e){document.getElementById("mine-count").textContent=e}function k(e){let i=document.getElementById("move-count");if(!i){const t=document.querySelector(".hud"),n=document.createElement("div");n.className="stat-box",n.innerHTML=`<span class="label">ì´ë™ íšŸìˆ˜</span><span id="move-count" class="value">${e}</span>`,t.appendChild(n),i=document.getElementById("move-count")}i.textContent=e}function h(e,i,t){const n=document.getElementById("game-board");n.innerHTML="";const s=e.length,a=e[0].length;n.style.gridTemplateColumns=`repeat(${a}, 32px)`;for(let r=0;r<s;r++)for(let c=0;c<a;c++){const u=e[r][c],l=document.createElement("div");l.classList.add("cell"),u.isActive||(l.style.visibility="hidden"),u.isRevealed?(l.classList.add("revealed"),u.isMine?(l.classList.add("mine"),u.flagState===1&&(l.classList.add("secured"),l.textContent="âœ…")):u.flagState===1?(l.classList.add("wrong-flag"),l.textContent="âŒ"):u.neighborMines>0?(l.textContent=u.neighborMines,l.dataset.dist="1"):u.distanceHint===2?l.dataset.dist="2":u.distanceHint===3?l.dataset.dist="3":l.classList.add("safe")):u.flagState===1?l.classList.add("flagged"):u.flagState===2&&l.classList.add("question"),l.addEventListener("click",()=>i(r,c)),l.addEventListener("contextmenu",m=>t(r,c,m)),n.appendChild(l)}}function E(e){const i=document.getElementById("intro-rank-list");if(!i)return;const t=document.querySelector(".intro-ranking h3");t&&!t.hasAttribute("data-init")&&(t.setAttribute("data-init","true"),t.style.cursor="pointer",t.title="í´ë¦­í•˜ì—¬ ë­í‚¹ ì´ˆê¸°í™”",t.addEventListener("click",()=>{confirm("ëª¨ë“  ë­í‚¹ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(N(),E(e))}));const n=M()[e]||[];if(n.length===0){i.innerHTML='<li style="text-align:center; color:var(--text-muted)">ê¸°ë¡ ì—†ìŒ</li>';return}i.innerHTML=n.map((s,a)=>`
    <li>
      <span class="rank">#${a+1}</span>
      <span class="name">${s.name}</span>
      <span class="score">${s.score}</span>
    </li>
  `).join("")}function q(e,i,t,n){const s=document.createElement("div");s.className="popup-overlay";const r=M()[n].map((c,u)=>`<li>${u+1}. ${c.name} - ${c.score}</li>`).join("");s.innerHTML=`
    <div class="popup-content">
      <h2>${t}</h2>
      <div class="score-display">ì ìˆ˜: ${i}</div>
      
      <div class="input-group">
        <input type="text" id="player-name" placeholder="ì´ë¦„ ì…ë ¥" maxlength="10">
        <button id="save-score-btn" class="btn primary small">ê¸°ë¡ ì €ì¥</button>
      </div>

      <div class="ranking-board">
        <h3>ğŸ† ${n.toUpperCase()} ë­í‚¹ ğŸ†</h3>
        <ul>${r}</ul>
      </div>

      <div class="action-buttons">
        <button id="restart-game-btn" class="btn secondary">ë‹¤ì‹œ ì‹œì‘</button>
        <button id="menu-btn" class="btn">ë©”ë‰´ë¡œ</button>
      </div>
    </div>
  `,document.body.appendChild(s),document.getElementById("app").classList.add("blurred"),s.querySelector("#save-score-btn").addEventListener("click",()=>{const c=s.querySelector("#player-name").value||"ìµëª…";w(n,c,i);const u=M()[n];s.querySelector("ul").innerHTML=u.map((l,m)=>`<li>${m+1}. ${l.name} - ${l.score}</li>`).join(""),s.querySelector("#save-score-btn").disabled=!0,s.querySelector("#save-score-btn").textContent="ì €ì¥ë¨"}),s.querySelector("#restart-game-btn").addEventListener("click",()=>{window.location.reload()}),s.querySelector("#menu-btn").addEventListener("click",()=>{window.location.reload()})}const d=new(window.AudioContext||window.webkitAudioContext),j=()=>{d.state==="suspended"&&d.resume()},v={start:()=>{try{const e=d.currentTime,i=d.createGain();i.connect(d.destination),i.gain.setValueAtTime(.3,e),i.gain.linearRampToValueAtTime(0,e+1.5);const t=d.createOscillator();t.type="sawtooth",t.frequency.setValueAtTime(100,e),t.frequency.exponentialRampToValueAtTime(800,e+1);const n=d.createBiquadFilter();n.type="lowpass",n.frequency.setValueAtTime(200,e),n.frequency.linearRampToValueAtTime(2e3,e+1),t.connect(n),n.connect(i),t.start(e),t.stop(e+1.5)}catch(e){console.error(e)}},move:()=>{try{const e=d.currentTime,i=d.createGain();i.connect(d.destination),i.gain.setValueAtTime(.5,e),i.gain.exponentialRampToValueAtTime(.01,e+1);const t=d.sampleRate*1,n=d.createBuffer(1,t,d.sampleRate),s=n.getChannelData(0);for(let l=0;l<t;l++)s[l]=(Math.random()*2-1)*.5;const a=d.createBufferSource();a.buffer=n;const r=d.createBiquadFilter();r.type="lowpass",r.frequency.setValueAtTime(150,e),r.frequency.linearRampToValueAtTime(50,e+.8),a.connect(r),r.connect(i),a.start(e);const c=d.createOscillator();c.type="sine",c.frequency.setValueAtTime(60,e),c.frequency.exponentialRampToValueAtTime(30,e+.8);const u=d.createGain();u.gain.setValueAtTime(.3,e),u.gain.linearRampToValueAtTime(0,e+.8),c.connect(u),u.connect(i),c.start(e),c.stop(e+1)}catch(e){console.error(e)}},boom:()=>{try{const e=d.currentTime,i=d.createGain();i.connect(d.destination),i.gain.setValueAtTime(1,e),i.gain.exponentialRampToValueAtTime(.01,e+2);const t=d.sampleRate*2,n=d.createBuffer(1,t,d.sampleRate),s=n.getChannelData(0);for(let c=0;c<t;c++)s[c]=Math.random()*2-1;const a=d.createBufferSource();a.buffer=n;const r=d.createBiquadFilter();r.type="lowpass",r.Q.value=1,r.frequency.setValueAtTime(1e3,e),r.frequency.exponentialRampToValueAtTime(50,e+1.5),a.connect(r),r.connect(i),a.start(e)}catch(e){console.error(e)}},click:()=>{try{const e=d.currentTime,i=d.createGain();i.connect(d.destination);const t=d.createOscillator();t.type="sine",t.frequency.setValueAtTime(800,e),t.frequency.exponentialRampToValueAtTime(400,e+.1);const n=d.createGain();n.gain.setValueAtTime(.1,e),n.gain.linearRampToValueAtTime(0,e+.1),t.connect(n),n.connect(i),t.start(e),t.stop(e+.1)}catch(e){console.error(e)}},win:()=>{try{const e=d.currentTime,i=d.createGain();i.connect(d.destination),[523.25,659.25,783.99,1046.5].forEach((n,s)=>{const a=d.createOscillator();a.type="triangle",a.frequency.setValueAtTime(n,e+s*.1);const r=d.createGain();r.gain.setValueAtTime(0,e+s*.1),r.gain.linearRampToValueAtTime(.2,e+s*.1+.05),r.gain.exponentialRampToValueAtTime(.01,e+s*.1+1.5),a.connect(r),r.connect(i),a.start(e+s*.1),a.stop(e+s*.1+2)})}catch(e){console.error(e)}}},o={difficulty:"easy",shape:"square",grid:[],mines:[],rows:0,cols:0,mineCount:0,timeLeft:0,score:0,timerId:null,countdownId:null,isGameOver:!1,movesLeft:0,movesSinceLastClick:0,totalMoveBudget:0,moveInterval:0},z={easy:{time:90,size:10,mineRange:[9,13],moveInterval:6,maxMoves:10},medium:{time:150,size:15,mineRange:[24,28],moveInterval:12,maxMoves:15},hard:{time:270,size:20,mineRange:[45,50],moveInterval:24,maxMoves:20}},J=document.getElementById("start-btn"),I=document.querySelectorAll("#difficulty-select .btn"),A=document.querySelectorAll("#shape-select .btn"),x=document.querySelectorAll(".tab-btn");F();E("easy");I.forEach(e=>{e.addEventListener("click",()=>{I.forEach(i=>i.classList.remove("active")),e.classList.add("active"),o.difficulty=e.dataset.value,o.difficulty!=="easy"?(document.querySelector('[data-value="square"]').click(),document.getElementById("shape-select").style.pointerEvents="none",document.getElementById("shape-select").style.opacity="0.5"):(document.getElementById("shape-select").style.pointerEvents="auto",document.getElementById("shape-select").style.opacity="1")})});A.forEach(e=>{e.addEventListener("click",()=>{A.forEach(i=>i.classList.remove("active")),e.classList.add("active"),o.shape=e.dataset.value})});x.forEach(e=>{e.addEventListener("click",()=>{x.forEach(i=>i.classList.remove("active")),e.classList.add("active"),E(e.dataset.rankTab)})});J.addEventListener("click",K);function K(){j(),v.start();const e=z[o.difficulty];o.timeLeft=e.time,o.rows=e.size,o.cols=e.size,o.isGameOver=!1,o.score=0,o.movesSinceLastClick=0,o.mineCount=Math.floor(Math.random()*(e.mineRange[1]-e.mineRange[0]+1))+e.mineRange[0],o.totalMoveBudget=e.maxMoves,o.movesLeft=o.totalMoveBudget,o.moveInterval=e.moveInterval,o.grid=V(o.rows,o.cols,o.shape,o.difficulty),o.mines=P(o.grid,o.mineCount),L(o.grid),W("game-screen"),h(o.grid,g,p),R(o.timeLeft),D(o.mineCount),k(o.movesLeft),_()}function _(){o.timerId&&clearInterval(o.timerId);const i=z[o.difficulty].time;o.timerId=setInterval(()=>{if(!o.isGameOver)if(o.timeLeft>0){o.timeLeft--,R(o.timeLeft);const t=i-o.timeLeft;t>0&&t%o.moveInterval===0&&o.movesLeft>0&&o.movesSinceLastClick<2&&Q()}else B(!1)},1e3)}function Q(){f("âš ï¸ ì§€ì§„ í™œë™ ê°ì§€! ì§€ë¢°ê°€ ì´ë™í•©ë‹ˆë‹¤! âš ï¸"),v.move(),H(o.grid,o.mines)&&(L(o.grid),o.movesLeft--,o.movesSinceLastClick++,k(o.movesLeft),h(o.grid,g,p),setTimeout(()=>f(""),2e3))}function g(e,i){if(o.isGameOver)return;const t=o.grid[e][i];if(!(t.flagState===1||t.isRevealed))if(o.movesSinceLastClick=0,v.click(),t.isMine)B(!0);else{const n=C(o.grid,e,i);o.score+=n,L(o.grid),h(o.grid,g,p),O(o.grid,o.mineCount)&&U()}}function p(e,i,t){if(t.preventDefault(),o.isGameOver)return;const n=o.grid[e][i];n.isRevealed||(o.movesSinceLastClick=0,G(n),h(o.grid,g,p))}function B(e,i){clearInterval(o.timerId),o.isGameOver=!0,e&&v.boom(),o.mines.forEach(a=>{o.grid[a.r][a.c].isRevealed=!0}),h(o.grid,g,p);const t=e?"ğŸ’¥ ì¾…! ê²Œì„ ì˜¤ë²„ ğŸ’¥":"â° ì‹œê°„ ì´ˆê³¼! â°";f(t),w(o.difficulty,"í”Œë ˆì´ì–´",o.score);let n=5;const s=document.createElement("div");s.style.marginTop="10px",s.style.color="#fff",document.querySelector(".hud").appendChild(s),o.countdownId=setInterval(()=>{n--,f(`${t} (${n}ì´ˆ í›„ ê²°ê³¼ ì°½)`),n<=0&&(clearInterval(o.countdownId),q(!1,o.score,t,o.difficulty))},1e3)}function U(){clearInterval(o.timerId),o.isGameOver=!0,v.win();const e=o.score*o.timeLeft+100;f("ğŸ† ì„ë¬´ ì™„ìˆ˜! ğŸ†"),w(o.difficulty,"í”Œë ˆì´ì–´",e);let i=5;o.countdownId=setInterval(()=>{i--,f(`ğŸ† ìŠ¹ë¦¬! ğŸ† (${i}ì´ˆ í›„ ê²°ê³¼ ì°½)`),i<=0&&(clearInterval(o.countdownId),q(!0,e,"ìŠ¹ë¦¬!",o.difficulty))},1e3)}
